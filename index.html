<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>14-–π –¥–µ–Ω—å —Ñ–µ–≤—Ä–∞–ª—è –º–µ—Å—è—Ü–∞! ‚ù§Ô∏è</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }

    :root{
      --bg1:#ff9a9e;
      --bg2:#fad0c4;
      --card: rgba(255,255,255,.94);
      --text:#1d3557;
      --accent:#e63946;
      --soft:#ffb3c1;
      --radius: 24px;
    }

    body{
      background: linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 100%);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      color: var(--text);
      text-align:center;

      min-height: 100svh;
      height: auto;
      overflow: auto;

      display:flex;
      justify-content:center;
      align-items: center;

      padding: 16px;
      padding-bottom: calc(16px + env(safe-area-inset-bottom));
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∫–∏ */
    .greeting-card {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #ff6b9d 0%, #c44569 50%, #ff9a9e 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 1;
      transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    }

    .greeting-card.hidden {
      opacity: 0;
      transform: scale(0.9);
      pointer-events: none;
    }

    .card-content {
      text-align: center;
      padding: 40px;
      max-width: 600px;
    }

    .animated-heart {
      font-size: clamp(5rem, 15vw, 8rem);
      margin: 30px 0;
      animation: heartbeat 1.2s ease-in-out infinite, float-heart 3s ease-in-out infinite;
      filter: drop-shadow(0 10px 30px rgba(255, 255, 255, 0.3));
    }

    .card-title {
      font-size: clamp(2rem, 8vw, 3rem);
      color: #fff;
      margin-bottom: 20px;
      text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
      animation: fadeInDown 1s ease-out;
    }

    .card-message {
      font-size: clamp(1.2rem, 4vw, 1.8rem);
      color: #fff;
      line-height: 1.6;
      margin-top: 30px;
      text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.2);
      animation: fadeInUp 1s ease-out 0.3s both;
    }

    .sparkles {
      position: absolute;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    .sparkle {
      position: absolute;
      width: 8px;
      height: 8px;
      background: #fff;
      border-radius: 50%;
      animation: sparkle 2s ease-in-out infinite;
    }

    @keyframes heartbeat {
      0%, 100% {
        transform: scale(1);
      }
      10% {
        transform: scale(1.1);
      }
      20% {
        transform: scale(1);
      }
      30% {
        transform: scale(1.15);
      }
      40% {
        transform: scale(1);
      }
    }

    @keyframes float-heart {
      0%, 100% {
        transform: translateY(0) rotate(0deg);
      }
      50% {
        transform: translateY(-20px) rotate(5deg);
      }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes sparkle {
      0%, 100% {
        opacity: 0;
        transform: scale(0);
      }
      50% {
        opacity: 1;
        transform: scale(1);
      }
    }

    .game-container{
      background: var(--card);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: 0 12px 34px rgba(0,0,0,.18);
      width: min(560px, 100%);
      position: relative;
      z-index: 10;
      opacity: 0;
      transition: opacity 0.8s ease-in;
    }

    .game-container.visible {
      opacity: 1;
    }

    h1{
      font-size: clamp(1.35rem, 3.8vw, 2.1rem);
      margin-bottom: 8px;
      color: var(--accent);
      text-shadow: 0 2px 6px rgba(0,0,0,.08);
      line-height: 1.15;
    }

    .subtitle{
      font-size: clamp(.95rem, 2.8vw, 1.05rem);
      margin-bottom: 12px;
      color: var(--text);
      font-weight: 600;
      opacity: .92;
      line-height: 1.35;
    }

    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin: 10px 0 12px;
      color: var(--text);
      font-weight: 800;
    }

    .pill{
      display:flex; justify-content:center; align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      font-size: clamp(.95rem, 2.7vw, 1.05rem);
      user-select:none;
    }
    .timer{ background: var(--accent); color:#fff; }
    .score{ background: var(--soft); }

    .meta{
      display:flex;
      gap:8px;
      margin-top: 8px;
      flex-wrap: wrap;
      color: var(--text);
      font-weight: 800;
      font-size: clamp(.9rem, 2.6vw, 1rem);
    }
    .meta .small{
      background: #f1faee;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px dashed rgba(230,57,70,.35);
      flex: 1 1 150px;
      min-width: 0;
    }

    .legend{
      display:flex;
      justify-content:center;
      flex-wrap: wrap;
      gap:8px;
      margin: 10px 0 12px;
      color: var(--text);
      font-weight: 800;
      font-size: clamp(.85rem, 2.5vw, .98rem);
      line-height: 1.2;
    }
    .chip{
      background: rgba(29,53,87,.06);
      border: 1px dashed rgba(230,57,70,.35);
      padding: 7px 10px;
      border-radius: 999px;
      user-select: none;
      max-width: 100%;
    }

    .game-area{
      background:#fef9f9;
      border-radius: 18px;

      height: min(52svh, 360px);
      min-height: 240px;

      position: relative;
      margin: 12px 0 14px;
      overflow:hidden;
      border: 3px dashed var(--soft);
      cursor: crosshair;
      box-shadow: inset 0 0 14px rgba(230,57,70,.16);

      touch-action: manipulation;
    }

    .message{
      position:absolute;
      left:50%; top:10px;
      transform:translateX(-50%);
      font-size: clamp(.95rem, 2.8vw, 1.08rem);
      min-height: 34px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(230,57,70,.10);
      color: var(--accent);
      font-weight: 900;
      opacity:0;
      transition: opacity .25s, transform .25s;
      pointer-events:none;
      z-index: 5;

      max-width: 92%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .message.show{
      opacity:1;
      transform: translateX(-50%) translateY(2px);
    }

    .btn{
      background: var(--accent);
      color:#fff;
      border:none;
      padding: 14px 18px;
      font-size: clamp(1rem, 3vw, 1.12rem);
      border-radius: 999px;
      cursor:pointer;
      transition: transform .12s, background .2s;
      font-weight: 900;
      letter-spacing: .4px;
      box-shadow: 0 8px 18px rgba(230,57,70,.28);
      width: 100%;
    }
    .btn:hover{ background:#c1121f; transform: scale(1.01); }
    .btn:active{ transform: scale(.99); }

    .end-screen{
      display:none;
      position:absolute;
      inset: 0;
      background: rgba(255,255,255,.98);
      border-radius: 18px;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      z-index:20;
      padding: 18px;
      color: var(--text);
    }

    .final-score{
      font-size: clamp(2.4rem, 10vw, 3.6rem);
      color: var(--accent);
      margin: 12px 0 6px;
      text-shadow: 0 3px 6px rgba(0,0,0,.08);
    }

    .love-message{
      font-size: clamp(1rem, 3vw, 1.15rem);
      color: var(--text);
      margin: 10px 0 14px;
      line-height: 1.35;
      max-width: 95%;
    }

    .signature{
      margin-top: 12px;
      font-style: italic;
      color: var(--text);
      font-size: clamp(.9rem, 2.6vw, 1rem);
      opacity:.88;
    }

    .pop{
      position:absolute;
      font-weight: 900;
      color: var(--accent);
      text-shadow: 0 2px 6px rgba(0,0,0,.15);
      pointer-events:none;
      animation: pop .55s ease-out forwards;
      z-index: 6;
    }
    @keyframes pop{
      0%{ transform: translate(-50%,-50%) scale(.9); opacity:0; }
      20%{ opacity:1; }
      100%{ transform: translate(-50%,-85%) scale(1.15); opacity:0; }
    }

    .item{
      position:absolute;
      font-size: clamp(1.9rem, 8vw, 2.35rem);
      cursor: pointer;
      user-select:none;
      text-shadow: 0 2px 6px rgba(0,0,0,.18);
      transition: transform .12s, opacity .18s;
      will-change: transform, opacity, left, top;
      animation: float 2.4s ease-in-out infinite;
    }
    .item:hover{ transform: scale(1.10); }

    @keyframes float{
      0%,100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-12px) rotate(5deg); }
    }

    .shake{ animation: shake .25s linear 1; }
    @keyframes shake{
      0%{ transform: translateX(0); }
      25%{ transform: translateX(-6px); }
      50%{ transform: translateX(6px); }
      75%{ transform: translateX(-4px); }
      100%{ transform: translateX(0); }
    }

    .confetti{
      position:absolute;
      width: 12px; height: 12px;
      background-color:#f36;
      animation: confetti-fall 4.8s ease-in-out forwards;
    }
    @keyframes confetti-fall{
      0%{ transform: translateY(-50px) rotate(0deg); opacity: 1; }
      100%{ transform: translateY(1000px) rotate(720deg); opacity: 0; }
    }

    .paused-overlay{
      display:none;
      position:absolute;
      inset:0;
      background: rgba(29,53,87,.10);
      backdrop-filter: blur(2px);
      z-index: 12;
      align-items:center;
      justify-content:center;
      color: var(--text);
      font-weight: 900;
      font-size: clamp(1.05rem, 3.5vw, 1.35rem);
    }
    .paused-overlay.show{ display:flex; }

    @media (max-width: 420px){
      body{ padding: 12px; padding-bottom: calc(12px + env(safe-area-inset-bottom)); }
      .game-container{ padding: 14px; border-radius: 18px; }
      .stats{ gap:8px; }
      .pill{ padding: 10px 10px; }
      .game-area{ border-width: 2px; }
      .card-content{ padding: 30px 20px; }
    }

    @media (prefers-reduced-motion: reduce){
      .item, .pop, .shake, .confetti, .animated-heart, .card-title, .card-message, .sparkle { animation: none !important; }
    }
  </style>
</head>

<body>
  <!-- –û—Ç–∫—Ä—ã—Ç–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ -->
  <div class="greeting-card" id="greeting-card">
    <div class="sparkles" id="sparkles"></div>
    <div class="card-content">
      <div class="card-title">–ú–∞—Å—é—Ç–∞ üíï</div>
      <div class="animated-heart">‚ù§Ô∏è</div>
      <div class="card-message">
                —Å 14-–º –¥–Ω—ë–º —Ñ–µ–≤—Ä–∞–ª—è –º–µ—Å—è—Ü–∞ <br>
                –º–Ø–£–£–£–£–£–£! üòä
            </div>
              </div>
    </div>
  </div>

  <div class="game-container" id="container">
    <h1>–ú–∞—Å—å–∫–∞, –ø–æ–ø—Ä–æ–±—É–π –ø–æ–π–º–∞—Ç—å –º–æ–∏ —Å–µ—Ä–¥–µ—á–∫–∏! ‚ù§Ô∏è</h1>
    <div class="subtitle" id="subtitle">
      –õ–æ–≤–∏ –∏—Ö –ø–æ–∫–∞ –Ω–µ —Ä–∞–∑–±–µ–∂–∞–ª–∏—Å—å! –£ —Ç–µ–±—è 30 —Å–µ–∫—É–Ω–¥! –ü—Ä–æ–±–µ–ª ‚Äî –ø–∞—É–∑–∞.
    </div>

    <div class="stats">
      <div class="pill timer">‚è±Ô∏è <span id="time">30</span> —Å–µ–∫</div>
      <div class="pill score">üíñ <span id="score">0</span></div>
    </div>

    <div class="meta">
      <div class="small">üî• –ö–æ–º–±–æ: <span id="combo">x1</span></div>
      <div class="small">üèÜ –†–µ–∫–æ—Ä–¥: <span id="best">0</span></div>
      <div class="small">üéöÔ∏è –£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></div>
    </div>

    <div class="legend" aria-label="–ª–µ–≥–µ–Ω–¥–∞">
      <div class="chip">‚ù§Ô∏è = +1</div>
      <div class="chip">üíõ = +5 –∏ +2 —Å–µ–∫</div>
      <div class="chip">üêæ (–ê—Å—è) = +3</div>
      <div class="chip">üí£ = ‚àí3 –∏ –∫–æ–º–±–æ –≤ –Ω–æ–ª—å</div>
      <div class="chip">–∫–ª–∏–∫ –º–∏–º–æ = ‚àí1</div>
    </div>

    <div class="game-area" id="game-area" aria-label="–∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ">
      <div class="message" id="message"></div>
      <div class="paused-overlay" id="paused">‚è∏Ô∏è –ü–∞—É–∑–∞ (–ø—Ä–æ–±–µ–ª)</div>
    </div>

    <button class="btn" id="start-btn">–ì–û–£–£–£–£–£!</button>

    <div class="end-screen" id="end-screen">
      <div>–¢—ã –ø–æ–π–º–∞–ª–∞</div>
      <div class="final-score" id="final-score">0</div>
      <div>—Å–±–µ–∂–∞–≤—à–∏—Ö —Å–µ—Ä–¥–µ—á–µ–∫!</div>
      <div class="love-message" id="love-message"></div>
      <button class="btn" id="restart-btn">–•–æ—á—É –µ—â—ë —Å–µ—Ä–¥–µ—á–µ–∫!</button>
    </div>

    <div class="signature" id="signature"></div>
  </div>

  <script>
    const wifeName = "–ú–∞—Å—å–∫–∞";
    const catName = "–ê—Å—è";

    // DOM
    const greetingCard = document.getElementById('greeting-card');
    const sparklesContainer = document.getElementById('sparkles');
    const container = document.getElementById('container');
    const gameArea = document.getElementById('game-area');
    const startBtn = document.getElementById('start-btn');
    const restartBtn = document.getElementById('restart-btn');
    const timeEl = document.getElementById('time');
    const scoreEl = document.getElementById('score');
    const messageEl = document.getElementById('message');
    const endScreen = document.getElementById('end-screen');
    const finalScoreEl = document.getElementById('final-score');
    const loveMessageEl = document.getElementById('love-message');
    const signatureEl = document.getElementById('signature');
    const comboEl = document.getElementById('combo');
    const bestEl = document.getElementById('best');
    const levelEl = document.getElementById('level');
    const pausedOverlay = document.getElementById('paused');

    signatureEl.textContent = `–¢–≤–æ–π –º—É–∂ ‚ù§Ô∏è –∏ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞ –ª–æ–≤–ª–∏ —Å–µ—Ä–¥–µ—á–µ–∫ ‚Äî ${catName} üêæ`;

    // –°–æ–∑–¥–∞—Ç—å –±–ª—ë—Å—Ç–∫–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∫–∏
    function createSparkles() {
      for (let i = 0; i < 30; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.style.left = `${Math.random() * 100}%`;
        sparkle.style.top = `${Math.random() * 100}%`;
        sparkle.style.animationDelay = `${Math.random() * 2}s`;
        sparkle.style.animationDuration = `${Math.random() * 2 + 1.5}s`;
        sparklesContainer.appendChild(sparkle);
      }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    function showGreetingCard() {
      createSparkles();
      
      // –°–∫—Ä—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç–∫—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(() => {
        greetingCard.classList.add('hidden');
        setTimeout(() => {
          container.classList.add('visible');
        }, 300);
      }, 3000);
    }

    // Game state
    let score = 0;
    let timeLeft = 30;
    let gameActive = false;
    let paused = false;

    let timerId = null;
    let spawnId = null;

    const items = new Set();

    // Combo
    let comboMult = 1;
    let lastHitAt = 0;

    // Difficulty
    let spawnEveryMs = 650;
    let itemLifeMs = 2900;

    // Best score
    const BEST_KEY = 'valentine_hearts_best';
    const best = Number(localStorage.getItem(BEST_KEY) || 0);
    bestEl.textContent = best;

    const clickMessages = [
      `–ê—Å—è –æ–¥–æ–±—Ä—è–µ—Ç. –ú—É—Ä-–º—É—Ä ‚úÖ`,
      `–õ–∞–ø–∫–æ–π –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å ‚Äî —ç—Ç–æ ${wifeName} –ª–æ–≤–∏—Ç! üêæ`,
      `–ü–æ–π–º–∞–ª–∞! ${catName} —É–∂–µ —Å—á–∏—Ç–∞–µ—Ç —Ç—Ä–æ—Ñ–µ–∏ üòº`,
      `–°–µ—Ä–¥–µ—á–∫–æ –≤ –∫–æ–ø–∏–ª–∫—É, –∫–æ—Ä–º ‚Äî –≤ –º–∏—Å–∫—É üòÑ`,
      `–û–ø–∞! –î–∞–∂–µ ${catName} —É–¥–∏–≤–∏–ª–∞—Å—å üò∫`,
      `–¢–∞–∫, —ç—Ç–æ –±—ã–ª–æ –±—ã—Å—Ç—Ä–æ. –ü–æ–¥–æ–∑—Ä–µ–≤–∞—é –ø–æ–º–æ—â—å –ª–∞–ø–æ–∫‚Ä¶ üêæ`,
      `–ú–∏–Ω—É—Å —Å—Ç—Ä–µ—Å—Å, –ø–ª—é—Å —Å–µ—Ä–¥–µ—á–∫–æ. –ü–ª–∞–Ω –∏–¥–µ–∞–ª—å–Ω—ã–π.`,
      `–õ–æ–≤–∏ –µ—â—ë ‚Äî ${catName} —Å–º–æ—Ç—Ä–∏—Ç –∫–∞–∫ —Å—É–¥—å—è –Ω–∞ –û–ª–∏–º–ø–∏–∞–¥–µ üèÖ`,
      `–ü–æ–π–º–∞–ª–∞! –¢–µ–ø–µ—Ä—å –ø–æ—á–µ—Å–∞—Ç—å ${catName} –∑–∞ —É—à–∫–æ–º ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.`,
      `–•–æ–ø! –°–µ—Ä–¥—Ü–µ —Å–ø–∞—Å–µ–Ω–æ, –±—Ä–∞–∫ —É–∫—Ä–µ–ø–ª—ë–Ω üòÑ`
    ];

    const endMessages = [
      `${wifeName}, —Ç—ã –ø–æ–π–º–∞–ª–∞ {score}. ${catName} –≥–æ–≤–æ—Ä–∏—Ç: "–º–æ–∂–Ω–æ –Ω–∞–≥—Ä–∞–¥—É‚Ä¶ –≤–∫—É—Å–Ω—è—à–∫—É?" üêæ`,
      `–†–µ–∑—É–ª—å—Ç–∞—Ç {score}. –Ø –≥–æ—Ä–∂—É—Å—å, ${wifeName}. ${catName} ‚Äî —Ç–æ–∂–µ (–Ω–æ –¥–µ–ª–∞–µ—Ç –≤–∏–¥, —á—Ç–æ –µ–π –≤—Å—ë —Ä–∞–≤–Ω–æ) üòº`,
      `–ü–æ–π–º–∞–Ω–æ {score}. –ü–æ —à–∫–∞–ª–µ –ª—é–±–≤–∏: "–ê—Å—è –ª–µ–≥–ª–∞ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∏ –≤—Å—ë –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç" üò∫`,
      `{score} —Å–µ—Ä–¥–µ—á–µ–∫! –ï—Å–ª–∏ –±—ã —ç—Ç–æ –±—ã–ª–∏ —Ä—ã–±–∫–∏ ‚Äî ${catName} —É–∂–µ –ø—Ä–∞–∑–¥–Ω–æ–≤–∞–ª–∞ –±—ã üé£`,
      `${wifeName}, {score} ‚Äî —ç—Ç–æ –º–æ—â–Ω–æ. –Ø –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –Ω–∞–∑–Ω–∞—á–∞—é —Ç–µ–±—è –ì–ª–∞–≤–Ω–æ–π –ø–æ –ª–æ–≤–ª–µ, –∞ ${catName} ‚Äî –Ω–∞—á–∞–ª—å–Ω–∏–∫–æ–º –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ üêæ`,
      `–°—á—ë—Ç {score}. –°–µ—Ä–¥—Ü–∞ –ø—ã—Ç–∞–ª–∏—Å—å —Å–±–µ–∂–∞—Ç—å, –Ω–æ ${wifeName} –±—ã—Å—Ç—Ä–µ–µ. ${catName} ‚Äî —Å–≤–∏–¥–µ—Ç–µ–ª—å –∏ —Å–æ—É—á–∞—Å—Ç–Ω–∏–∫ üòº`
    ];

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function showMessage(text) {
      messageEl.textContent = text;
      messageEl.classList.add('show');
      clearTimeout(showMessage._t);
      showMessage._t = setTimeout(() => messageEl.classList.remove('show'), 850);
    }

    function popText(text, x, y, color = '#e63946'){
      const el = document.createElement('div');
      el.className = 'pop';
      el.textContent = text;
      el.style.left = x + 'px';
      el.style.top = y + 'px';
      el.style.color = color;
      gameArea.appendChild(el);
      setTimeout(() => el.remove(), 600);
    }

    function updateDifficulty(){
      const level = clamp(1 + Math.floor(score / 12), 1, 10);
      levelEl.textContent = level;

      spawnEveryMs = clamp(650 - (level - 1) * 45, 260, 650);
      itemLifeMs = clamp(2900 - (level - 1) * 140, 1200, 2900);
    }

    function updateCombo(now){
      const dt = now - lastHitAt;
      if (dt <= 900) comboMult = clamp(comboMult + 1, 1, 4);
      else comboMult = 1;

      lastHitAt = now;
      comboEl.textContent = 'x' + comboMult;
    }

    function resetCombo(){
      comboMult = 1;
      comboEl.textContent = 'x1';
    }

    function randomItemType(){
      // heart 74%, gold 12%, bomb 8%, asya paw 6%
      const r = Math.random();
      if (r < 0.08) return 'bomb';
      if (r < 0.20) return 'gold';
      if (r < 0.26) return 'asya';
      return 'heart';
    }

    function createItem() {
      if (!gameActive || paused) return;

      const type = randomItemType();
      const el = document.createElement('div');
      el.className = 'item';

      let emoji = '‚ù§Ô∏è';
      if (type === 'gold') emoji = 'üíõ';
      if (type === 'bomb') emoji = 'üí£';
      if (type === 'asya') emoji = 'üêæ';
      el.textContent = emoji;
      el.dataset.type = type;

      const pad = 24;
      const x = Math.random() * (gameArea.clientWidth - pad*2) + pad;
      const y = Math.random() * (gameArea.clientHeight - pad*2) + pad;

      el.style.left = (x - 16) + 'px';
      el.style.top  = (y - 18) + 'px';

      el.style.animationDelay = (Math.random() * 1.6) + 's';

      const bornAt = performance.now();
      const life = itemLifeMs + Math.random() * 350;

      const onHit = (ev) => {
        ev.stopPropagation();
        if (!gameActive || paused) return;

        const now = performance.now();
        const rect = gameArea.getBoundingClientRect();
        const px = (ev.clientX || (ev.touches && ev.touches[0].clientX) || 0) - rect.left;
        const py = (ev.clientY || (ev.touches && ev.touches[0].clientY) || 0) - rect.top;

        el.style.transform = 'scale(1.6)';
        el.style.opacity = '0';
        el.style.pointerEvents = 'none';

        if (type === 'bomb'){
          score = Math.max(0, score - 3);
          scoreEl.textContent = score;
          resetCombo();
          container.classList.add('shake');
          setTimeout(() => container.classList.remove('shake'), 260);
          showMessage('–ë–ê–ë–ê–•! ‚àí3 –∏ –∫–æ–º–±–æ –≤ –Ω–æ–ª—å üí£');
          popText('-3', px, py, '#1d3557');
        } else if (type === 'gold'){
          updateCombo(now);
          const add = 5 * comboMult;
          score += add;
          scoreEl.textContent = score;
          timeLeft = Math.min(45, timeLeft + 2);
          timeEl.textContent = timeLeft;
          showMessage('–ó–æ–ª–æ—Ç–æ–µ! +5 –∏ +2 —Å–µ–∫ üíõ');
          popText('+' + add, px, py, '#f77f00');
        } else if (type === 'asya'){
          updateCombo(now);
          const add = 3 * comboMult;
          score += add;
          scoreEl.textContent = score;
          showMessage(`${catName}: "–º—É—Ä-–±—É—Å—Ç!" üêæ +${add}`);
          popText('+' + add, px, py, '#118ab2');
        } else {
          updateCombo(now);
          const add = 1 * comboMult;
          score += add;
          scoreEl.textContent = score;
          showMessage(clickMessages[(Math.random()*clickMessages.length)|0]);
          popText('+' + add, px, py, '#e63946');
        }

        updateDifficulty();
        scheduleSpawns();

        setTimeout(() => removeItem(el), 160);
      };

      el.addEventListener('click', onHit, { passive: true });
      el.addEventListener('touchstart', onHit, { passive: true });

      gameArea.appendChild(el);
      items.add(el);

      setTimeout(() => {
        if (!items.has(el) || !gameActive) return;
        el.style.opacity = '0.35';
        setTimeout(() => removeItem(el), 240);
      }, life);

      const moveId = setInterval(() => {
        if (!items.has(el) || !gameActive || paused) return;
        const t = performance.now() - bornAt;
        const drift = Math.sin(t/260) * 10;
        el.style.transform = `translateX(${drift}px)`;
      }, 120);

      el._moveId = moveId;
    }

    function removeItem(el){
      if (!el) return;
      if (el._moveId) clearInterval(el._moveId);
      if (items.has(el)) items.delete(el);
      if (el.parentNode) el.parentNode.removeChild(el);
    }

    function clearItems(){
      for (const el of Array.from(items)) removeItem(el);
      items.clear();
    }

    function createConfetti(){
      const colors = ['#e63946','#f77f00','#06d6a0','#118ab2','#ef476f'];
      const count = 90;
      for (let i=0;i<count;i++){
        const c = document.createElement('div');
        c.className = 'confetti';
        c.style.backgroundColor = colors[(Math.random()*colors.length)|0];
        c.style.left = (Math.random()*100) + '%';
        c.style.top  = (Math.random()*18 - 18) + 'px';
        c.style.width  = (Math.random()*10 + 5) + 'px';
        c.style.height = (Math.random()*10 + 5) + 'px';
        c.style.transform = `rotate(${Math.random()*360}deg)`;
        c.style.animationDuration = (Math.random()*2.6 + 2.2) + 's';
        document.body.appendChild(c);
        setTimeout(() => c.remove(), 5200);
      }
    }

    function startTimer(){
      clearInterval(timerId);
      timeLeft = 30;
      timeEl.textContent = timeLeft;

      timerId = setInterval(() => {
        if (!gameActive || paused) return;
        timeLeft--;
        timeEl.textContent = timeLeft;

        if (timeLeft === 10) showMessage("–í—Ä–µ–º—è –ø–æ—á—Ç–∏ –≤—ã—à–ª–æ! ‚è∞");
        if (timeLeft === 5) showMessage("–°–µ—Ä–¥—Ü–∞ —É–±–µ–≥–∞—é—Ç! üèÉ‚Äç‚ôÇÔ∏èüí®");
        if (timeLeft <= 0) endGame();
      }, 1000);
    }

    function scheduleSpawns(){
      clearInterval(spawnId);
      spawnId = setInterval(() => createItem(), spawnEveryMs);
    }

    function setPaused(next){
      if (!gameActive) return;
      paused = next;
      pausedOverlay.classList.toggle('show', paused);
      if (!paused) showMessage('–ü–æ–µ—Ö–∞–ª–∏! (–ê—Å—è –Ω–∞–±–ª—é–¥–∞–µ—Ç) üêæ');
    }

    function togglePause(){
      setPaused(!paused);
    }

    function startGame(){
      score = 0;
      scoreEl.textContent = '0';
      resetCombo();
      updateDifficulty();

      endScreen.style.display = 'none';
      gameActive = true;
      paused = false;
      pausedOverlay.classList.remove('show');

      clearItems();
      startTimer();
      scheduleSpawns();

      for (let i=0;i<4;i++) setTimeout(createItem, i*220);

      showMessage(`–õ–æ–≤–∏! –ò –ø–æ–º–Ω–∏: ${catName} —Ç—É—Ç –≥–ª–∞–≤–Ω–∞—è üêæ`);
    }

    function endGame(){
      if (!gameActive) return;
      gameActive = false;
      paused = false;

      clearInterval(timerId);
      clearInterval(spawnId);
      clearItems();

      finalScoreEl.textContent = score;

      const prevBest = Number(localStorage.getItem(BEST_KEY) || 0);
      if (score > prevBest){
        localStorage.setItem(BEST_KEY, String(score));
        bestEl.textContent = score;
      }

      const msg = endMessages[(Math.random()*endMessages.length)|0].replace('{score}', score);
      loveMessageEl.textContent = msg;

      createConfetti();
      setTimeout(() => endScreen.style.display = 'flex', 650);
    }

    // Click miss penalty (field click)
    gameArea.addEventListener('click', (ev) => {
      if (!gameActive || paused) return;

      score = Math.max(0, score - 1);
      scoreEl.textContent = score;
      resetCombo();
      updateDifficulty();
      scheduleSpawns();

      const rect = gameArea.getBoundingClientRect();
      popText('-1', (ev.clientX - rect.left), (ev.clientY - rect.top), '#1d3557');
      showMessage(`${catName}: "–ø—Ä–æ–º–∞—Ö‚Ä¶ —Ö–æ—á—É –∫—É—à–∞—Ç—å" üòº`);
    });

    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', startGame);

    window.addEventListener('keydown', (e) => {
      if (e.code === 'Space'){
        e.preventDefault();
        togglePause();
      }
    });

    // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', showGreetingCard);

    // Small "teaser" before start (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∫–∏)
    setTimeout(() => {
      if (gameActive) return;
      gameActive = true;
      paused = true;
      pausedOverlay.classList.add('show');
      createItem();
      showMessage(`${catName} –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª–µ‚Ä¶ üêæ`);
      setTimeout(() => {
        gameActive = false;
        paused = false;
        pausedOverlay.classList.remove('show');
        clearItems();
        showMessage('–ù–∞–∂–º–∏ –ì–û–£! (–ê—Å—è —É–∂–µ –≥–æ—Ç–æ–≤–∞ —Å—É–¥–∏—Ç—å) üòº');
      }, 900);
    }, 4000); // –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∫–∏ (3 —Å–µ–∫ + 1 —Å–µ–∫ –∑–∞–ø–∞—Å)
  </script>
</body>
</html>